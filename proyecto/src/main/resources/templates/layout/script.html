<div th:fragment="script">
    <!-- jQuery  -->
    <script src="../../../../assets/js/jquery.min.js"></script>
    <script src="../../../../assets/js/bootstrap.bundle.min.js"></script>
    <script src="../../../../assets/js/modernizr.min.js"></script>
    <script src="../../../../assets/js/detect.js"></script>
    <script src="../../../../assets/js/fastclick.js"></script>
    <script src="../../../../assets/js/jquery.slimscroll.js"></script>
    <script src="../../../../assets/js/jquery.blockUI.js"></script>
    <script src="../../../../assets/js/waves.js"></script>
    <script src="../../../../assets/js/jquery.nicescroll.js"></script>
    <script src="../../../../assets/js/jquery.scrollTo.min.js"></script>

    <!-- skycons -->
    <script src="../../../../assets/plugins/skycons/skycons.min.js"></script>

    <!-- skycons -->
    <script src="../../../../assets/plugins/peity/jquery.peity.min.js"></script>

    <!--Morris Chart-->
    <!-- <script src="../../../../assets/plugins/morris/morris.min.js"></script> -->
    <!-- <script src="../../../../assets/plugins/raphael/raphael-min.js"></script> -->

    <!-- dashboard -->
    <!-- <script src="../../../../assets/pages/dashboard.js"></script> -->

    <!-- Required datatable js -->
    <script src="../../../../assets/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="../../../../assets/plugins/datatables/dataTables.bootstrap4.min.js"></script>
    <!-- Buttons examples -->
    <script src="../../../../assets/plugins/datatables/dataTables.buttons.min.js"></script>
    <script src="../../../../assets/plugins/datatables/buttons.bootstrap4.min.js"></script>
    <script src="../../../../assets/plugins/datatables/jszip.min.js"></script>
    <script src="../../../../assets/plugins/datatables/pdfmake.min.js"></script>
    <script src="../../../../assets/plugins/datatables/vfs_fonts.js"></script>
    <script src="../../../../assets/plugins/datatables/buttons.html5.min.js"></script>
    <script src="../../../../assets/plugins/datatables/buttons.print.min.js"></script>
    <script src="../../../../assets/plugins/datatables/buttons.colVis.min.js"></script>
    <!-- Responsive examples -->
    <script src="../../../../assets/plugins/datatables/dataTables.responsive.min.js"></script>
    <script src="../../../../assets/plugins/datatables/responsive.bootstrap4.min.js"></script>

    <!-- Datatable init js -->
    <script src="../../../../assets/pages/datatables.init.js"></script>

    <!-- Plugins js -->
    <script src="../../../../assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
    <script src="../../../../assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="../../../../assets/plugins/bootstrap-maxlength/bootstrap-maxlength.min.js"></script>
    <script src="../../../../assets/plugins/bootstrap-touchspin/js/jquery.bootstrap-touchspin.min.js"></script>
    <!-- App js -->
    <script src="../../../../assets/js/app.js"></script>
    <script src="../../../../assets/js/fragment.js"></script>

    <!-- INICIO TODOS ESTOS ARCHIVOS SON PARA SELECT BUSCADOR-->
    <script src="../../../../vendors/choices/choices.min.js"></script>
    <script src="../../../../vendors/anchorjs/anchor.min.js"></script><!--esto-->
    <script src="../../../../vendors/lodash/lodash.min.js"></script><!--esto-->
    <!-- <script src="../../../../assets/js/theme.js"></script> -->
    <!-- FIN TODOS ESTOS ARCHIVOS SON PARA SELECT BUSCADOR-->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- SWEET-ALERT JS -->
    <script src="../../../../assets/plugins/sweet-alert2/sweetalert2.min.js"></script>
    <!-- JS de Tagify -->
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify@4.6.0/dist/tagify.min.js"></script>

    <script>

        if (typeof showGlobalLoader !== 'function') {
            window.showGlobalLoader = function () { /* no-op */ };
        }
        if (typeof hideGlobalLoader !== 'function') {
            window.hideGlobalLoader = function () { /* no-op */ };
        }
        if (typeof cargarFormularioAlert !== 'function') {
            window.cargarFormularioAlert = function (url, contenedorModal, selectorForm) {
                $.post(url).done(html => {
                    $(contenedorModal).html(html);
                    $('#modalFormularioPersona').modal('show');
                }).fail(() => Swal.fire('Error', 'No se pudo cargar el formulario.', 'error'));
            };
        }
        if (typeof cargarFormularioEditAlert !== 'function') {
            window.cargarFormularioEditAlert = function (idEnc, baseUrl, contenedorModal, selectorForm) {
                $.post(`${baseUrl}/${idEnc}`).done(html => {
                    $(contenedorModal).html(html);
                    $('#modalFormularioPersona').modal('show');
                }).fail(() => Swal.fire('Error', 'No se pudo cargar el formulario de edición.', 'error'));
            };
        }
        if (typeof eliminarRegistroAlert !== 'function') {
            window.eliminarRegistroAlert = function (nombre, idEnc, baseUrl, onOk) {
                Swal.fire({
                    title: 'Eliminar registro',
                    text: `¿Deseas eliminar ${nombre}?`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Eliminar',
                    cancelButtonText: 'Cancelar'
                }).then(res => {
                    if (!res.isConfirmed) return;
                    $.post(`${baseUrl}/${idEnc}`)
                        .done(() => { if (typeof onOk === 'function') onOk(); })
                        .fail(() => Swal.fire('Error', 'No se pudo eliminar.', 'error'));
                });
            };
        }

        (function () {
            let $contenido = $("#contenido");
            let $currentActive = null;

            // ===== CONFIG opcional: endpoint de "pre-carga" al estilo de tu primer ejemplo =====
            const USE_PREFETCH = false; // cambia a false si no lo necesitas
            const PREFETCH_URL = "/adm/cargar-datos";

            // ===== CARGA ASÍNCRONA DEL CONTENIDO =====
            function cargarContenido(url, pushHistory = true) {
                if (!$contenido.length) return;

                // Spinner
                $contenido.html(
                    '<div class="d-flex justify-content-center">' +
                    '  <div class="spinner-border m-5" role="status">' +
                    '    <span class="visually-hidden">Cargando...</span>' +
                    '  </div>' +
                    '</div>'
                );

                const doLoad = () => {
                    $.ajax({
                        url,
                        method: "GET",
                        success: function (html) {
                            $contenido.html(html);
                            const hrefToPush = $(`a.menu-ajax[data-url="${url}"]`).data('href') || url;
                            if (pushHistory && window.history && window.history.pushState) {
                                window.history.pushState({ url: hrefToPush }, "", hrefToPush);
                            }
                        },
                        error: function (xhr) {
                            if (xhr.status === 401) {
                                Swal.fire({
                                    title: 'Sesión expirada',
                                    text: 'Tu sesión ha expirado. Por favor, inicia sesión nuevamente.',
                                    icon: 'warning',
                                    confirmButtonText: 'Ir al login'
                                }).then(() => window.location.href = '/');
                                return;
                            }
                            console.error('Error al cargar la vista:', xhr);
                            $contenido.html('<div class="alert alert-danger m-3">Error al cargar la vista.</div>');
                        }
                    });
                };

                if (USE_PREFETCH) {
                    // Igual que tu ejemplo: primero golpe corto para refrescar datos/estado
                    $.get(PREFETCH_URL).always(doLoad);
                } else {
                    doLoad();
                }
            }

            // ===== MARCAR ACTIVO EN EL SIDEBAR =====
            function setActive($a) {
                if ($currentActive) $currentActive.removeClass('active');

                // Activa el <li> contenedor del enlace
                $currentActive = $a.closest('li');
                $currentActive.addClass('active');

                // Abre padres si tu plantilla colapsa submenús
                $currentActive.parents('li.has_sub').addClass('active opened');
            }

            // ===== CLICK DELEGADO PARA ENLACES ASÍNCRONOS =====
            $(document).on('click', 'a.menu-ajax', function (e) {
                e.preventDefault();
                const $a = $(this);
                const url = $a.data('url');
                if (!url) return;

                setActive($a);
                cargarContenido(url, true);

                // Si estás en móvil y deseas cerrar el menú lateral al click:
                $('.button-menu-mobile.open-left').trigger('click');
            });

            // ===== SOPORTE PARA BOTÓN ATRÁS/DELANTE DEL NAVEGADOR =====
            window.addEventListener('popstate', function (ev) {
                const state = ev.state || {};
                if (state.url) {
                    cargarContenido(state.url, false);
                }
            });

            // ===== CARGA POR DEFECTO (al entrar) =====
            $(document).ready(function () {
                if (document.body.dataset.ctx === "A" && $contenido.length) {
                    // Busca un enlace marcado como data-default="true"
                    const $default = $('a.menu-ajax[data-default="true"]').first();
                    if ($default.length) {
                        setActive($default);
                        cargarContenido($default.data('url'), true);
                    }
                }
            });
        })();
    </script>
</div>